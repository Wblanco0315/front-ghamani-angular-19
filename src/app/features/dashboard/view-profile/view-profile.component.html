<div class="view-profile">
  <!-- Header -->
  <div class="profile-header">
    <div class="header-content">
      <h1 class="page-title">Mi Perfil</h1>
      <p class="page-subtitle">Gestiona tu información personal</p>
    </div>
    <div class="header-actions" *ngIf="!isEditing()">
      <button
        (click)="enableEdit()"
        class="btn-edit"
        [disabled]="isLoading()">
        <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
            <path d="M7 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-1"/>
            <path d="M20.385 6.585a2.1 2.1 0 0 0-2.97-2.97L9 12v3h3zM16 5l3 3"/>
          </g>
        </svg>
        Editar Perfil
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Cargando información del perfil...</p>
  </div>

  <!-- Profile Content -->
  <div *ngIf="!isLoading() && userProfile()" class="profile-content">
    
    <!-- User Avatar Section -->
    <div class="avatar-section">
      <div class="user-avatar">
        <div class="avatar-circle">
          <i class="fas fa-user"></i>
        </div>
        <div class="avatar-info">
          <h2 class="user-name">{{ userProfile()?.nombre }}</h2>
          <span class="user-role">{{ getRoleDisplayName(userProfile()?.role || '') }}</span>
          <span class="join-date">
            Miembro desde {{ formatDate(userProfile()?.fechaRegistro || '') }}
          </span>
        </div>
      </div>
      <div class="quick-actions">
        <button
          (click)="openPasswordModal()"
          class="btn-secondary"
          [disabled]="isLoading()">
          <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
              <rect width="18" height="11" x="3" y="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </g>
          </svg>
          Cambiar Contraseña
        </button>
      </div>
    </div>

    <!-- Profile Information -->
    <div class="profile-info">
      <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
        
        <!-- Personal Information Section -->
        <div class="info-section">
          <div class="section-header">
            <h3 class="section-title">Información Personal</h3>
            <div class="section-divider"></div>
          </div>

          <div class="form-grid">
            <!-- Nombre -->
            <div class="form-group">
              <label for="nombre">Nombre Completo *</label>
              <input
                type="text"
                id="nombre"
                formControlName="nombre"
                class="form-input"
                [class.error]="getFieldError('nombre')"
                [readonly]="!isEditing()">
              <span *ngIf="getFieldError('nombre')" class="error-message">
                {{ getFieldError('nombre') }}
              </span>
            </div>

            <!-- Username -->
            <div class="form-group">
              <label for="username">Nombre de Usuario *</label>
              <input
                type="text"
                id="username"
                formControlName="username"
                class="form-input"
                [class.error]="getFieldError('username')"
                [readonly]="!isEditing()">
              <span *ngIf="getFieldError('username')" class="error-message">
                {{ getFieldError('username') }}
              </span>
            </div>

            <!-- Email -->
            <div class="form-group">
              <label for="email">Correo Electrónico *</label>
              <input
                type="email"
                id="email"
                formControlName="email"
                class="form-input"
                [class.error]="getFieldError('email')"
                [readonly]="!isEditing()">
              <span *ngIf="getFieldError('email')" class="error-message">
                {{ getFieldError('email') }}
              </span>
            </div>

            <!-- Teléfono -->
            <div class="form-group">
              <label for="telefono">Teléfono</label>
              <input
                type="tel"
                id="telefono"
                formControlName="telefono"
                class="form-input"
                [class.error]="getFieldError('telefono')"
                [readonly]="!isEditing()"
                placeholder="+57 300 123 4567">
              <span *ngIf="getFieldError('telefono')" class="error-message">
                {{ getFieldError('telefono') }}
              </span>
            </div>

            <!-- Fecha de Nacimiento -->
            <div class="form-group">
              <label for="fechaNacimiento">Fecha de Nacimiento</label>
              <input
                type="date"
                id="fechaNacimiento"
                formControlName="fechaNacimiento"
                class="form-input"
                [readonly]="!isEditing()">
            </div>

            <!-- Género -->
            <div class="form-group">
              <label for="genero">Género</label>
              <select
                id="genero"
                formControlName="genero"
                class="form-select"
                [disabled]="!isEditing()">
                <option value="">Seleccionar</option>
                <option value="FEMENINO">Femenino</option>
                <option value="MASCULINO">Masculino</option>
                <option value="OTRO">Otro</option>
                <option value="NO_ESPECIFICAR">Prefiero no especificar</option>
              </select>
            </div>
          </div>

          <!-- Dirección -->
          <div class="form-group full-width">
            <label for="direccion">Dirección</label>
            <textarea
              id="direccion"
              formControlName="direccion"
              class="form-textarea"
              [readonly]="!isEditing()"
              rows="3"
              placeholder="Ingresa tu dirección completa"></textarea>
          </div>
        </div>

        <!-- Action Buttons -->
        <div *ngIf="isEditing()" class="form-actions">
          <button
            type="button"
            (click)="cancelEdit()"
            class="btn-cancel"
            [disabled]="isLoading()">
            Cancelar
          </button>
          <button
            type="submit"
            class="btn-save"
            [disabled]="!isFormValid() || isLoading()">
            <span *ngIf="isLoading()">Guardando...</span>
            <span *ngIf="!isLoading()">Guardar Cambios</span>
          </button>
        </div>

      </form>
    </div>
  </div>
</div>

<!-- Modal para cambiar contraseña -->
<div *ngIf="showPasswordModal()" class="modal-overlay" (click)="closePasswordModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Cambiar Contraseña</h2>
      <button (click)="closePasswordModal()" class="btn-close">✕</button>
    </div>

    <form [formGroup]="passwordForm" (ngSubmit)="changePassword()" class="password-form">
      <div class="form-group">
        <label for="currentPassword">Contraseña Actual *</label>
        <input
          type="password"
          id="currentPassword"
          formControlName="currentPassword"
          class="form-input"
          [class.error]="getPasswordFieldError('currentPassword')">
        <span *ngIf="getPasswordFieldError('currentPassword')" class="error-message">
          {{ getPasswordFieldError('currentPassword') }}
        </span>
      </div>

      <div class="form-group">
        <label for="newPassword">Nueva Contraseña *</label>
        <input
          type="password"
          id="newPassword"
          formControlName="newPassword"
          class="form-input"
          [class.error]="getPasswordFieldError('newPassword')"
          placeholder="Mínimo 6 caracteres">
        <span *ngIf="getPasswordFieldError('newPassword')" class="error-message">
          {{ getPasswordFieldError('newPassword') }}
        </span>
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirmar Nueva Contraseña *</label>
        <input
          type="password"
          id="confirmPassword"
          formControlName="confirmPassword"
          class="form-input"
          [class.error]="getPasswordFieldError('confirmPassword')">
        <span *ngIf="getPasswordFieldError('confirmPassword')" class="error-message">
          {{ getPasswordFieldError('confirmPassword') }}
        </span>
      </div>

      <div class="form-actions">
        <button type="button" (click)="closePasswordModal()" class="btn-cancel">
          Cancelar
        </button>
        <button
          type="submit"
          class="btn-save"
          [disabled]="passwordForm.invalid || isLoading()">
          <span *ngIf="isLoading()">Cambiando...</span>
          <span *ngIf="!isLoading()">Cambiar Contraseña</span>
        </button>
      </div>
    </form>
  </div>
</div>
